<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Fiscal para N√≥madas Digitales en Espa√±a</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Neutrals with Blue Accent -->
    <!-- Application Structure Plan: La aplicaci√≥n se centra en la decisi√≥n fiscal m√°s cr√≠tica para un n√≥mada digital: R√©gimen General vs. Ley Beckham. La arquitectura se organiza en dos vistas principales accesibles por pesta√±as: "Simulador" y "Gu√≠a Detallada". El Simulador es el punto de partida, ofreciendo una comparaci√≥n visual y cuantitativa inmediata para captar el inter√©s del usuario. La Gu√≠a Detallada utiliza secciones colapsables (acordeones) para presentar informaci√≥n densa (obligaciones, errores comunes, etc.) de forma progresiva. Esta estructura prioriza la acci√≥n y la personalizaci√≥n sobre la lectura pasiva, guiando al usuario desde una visi√≥n general y personalizada hacia los detalles espec√≠ficos que necesita, mejorando as√≠ la usabilidad y la retenci√≥n de informaci√≥n. -->
    <!-- Visualization & Content Choices: 1) Comparaci√≥n de Impuestos: Report Info -> Tramos IRPF vs. tipo fijo Beckham. Goal -> Ayudar a decidir qu√© r√©gimen es m√°s beneficioso. Viz/Presentation -> Gr√°fico de barras interactivo (Chart.js) y tarjetas de resultados. Interaction -> El usuario introduce sus ingresos brutos y el gr√°fico y las tarjetas se actualizan en tiempo real. Justification -> La visualizaci√≥n directa del ahorro potencial es la forma m√°s efectiva y persuasiva de comunicar la diferencia entre ambos reg√≠menes. 2) Requisitos y Plazos: Report Info -> Plazo de 6 meses para Beckham, requisitos de visado. Goal -> Informar de puntos cr√≠ticos y urgentes. Viz/Presentation -> Tarjetas destacadas con iconos y texto en negrita (HTML/Tailwind). Interaction -> Est√°tico pero visualmente prominente. Justification -> Asegura que la informaci√≥n m√°s sensible al tiempo y a la elegibilidad no pase desapercibida. 3) FAQ y Errores: Report Info -> Preguntas y errores comunes. Goal -> Resolver dudas y prevenir problemas. Viz/Presentation -> Acorde√≥n interactivo (HTML/JS). Interaction -> Click para expandir/colapsar respuestas. Justification -> Permite al usuario explorar las preguntas de su inter√©s sin ser abrumado por un bloque de texto largo. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .tab-button { transition: all 0.3s ease; border-bottom: 4px solid transparent; }
        .tab-button.active { border-color: #3b82f6; color: #1e3a8a; }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 350px; max-height: 400px; }
        @media (max-width: 768px) { .chart-container { height: 300px; } }
        .guide-menu-item { transition: all 0.2s ease-in-out; }
        .guide-menu-item.active { background-color: #e0f2fe; color: #0c4a6e; border-right: 4px solid #3b82f6; }
        .guide-content-panel { display: none; }
        .guide-content-panel.active { display: block; }
        .table-custom { width: 100%; border-collapse: collapse; }
        .table-custom th, .table-custom td { border: 1px solid #e5e7eb; padding: 12px; text-align: left; }
        .table-custom th { background-color: #f3f4f6; font-weight: 600; }
        .table-custom tr:nth-child(even) { background-color: #f9fafb; }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-2">Gu√≠a Fiscal para N√≥madas Digitales en Espa√±a</h1>
            <p class="text-lg md:text-xl text-gray-600">Su herramienta interactiva para la planificaci√≥n fiscal.</p>
        </header>

        <div class="bg-white rounded-2xl shadow-lg p-2 mb-8">
            <nav class="flex justify-center items-center space-x-2 md:space-x-4 border-b border-gray-200">
                <button id="tab-simulador" class="tab-button active w-full text-center font-semibold py-3 px-4 text-gray-600 hover:text-blue-600">
                    <span class="text-xl mr-2">üìä</span> Simulador Fiscal
                </button>
                <button id="tab-guia" class="tab-button w-full text-center font-semibold py-3 px-4 text-gray-600 hover:text-blue-600">
                    <span class="text-xl mr-2">üìö</span> Gu√≠a Detallada
                </button>
            </nav>

            <main class="p-4 md:p-8">
                <section id="simulador-section" class="content-section active">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-gray-800">¬øR√©gimen General o Ley Beckham?</h2>
                        <p class="text-gray-600 mt-2 max-w-3xl mx-auto">La decisi√≥n m√°s importante que tomar√° como n√≥mada digital en Espa√±a es su r√©gimen fiscal. Introduzca sus ingresos anuales brutos para comparar instant√°neamente su carga fiscal estimada y descubrir cu√°l podr√≠a ser m√°s beneficioso para usted.</p>
                    </div>

                    <div class="grid lg:grid-cols-5 gap-8 items-start">
                        <div class="lg:col-span-2 space-y-6">
                            <form id="tax-simulator-form" class="space-y-4 bg-gray-50 p-6 rounded-xl border border-gray-200">
                                <div>
                                    <label for="annual-income" class="block text-sm font-medium text-gray-700 mb-1">Ingresos Anuales Brutos (‚Ç¨)</label>
                                    <input type="number" id="annual-income" name="annual-income" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3" placeholder="Ej: 70000" required>
                                </div>
                                <div class="relative flex items-start">
                                    <div class="flex h-5 items-center">
                                        <input id="capital-gains" name="capital-gains" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    </div>
                                    <div class="ml-3 text-sm">
                                        <label for="capital-gains" class="font-medium text-gray-700">Tengo rentas de capital fuera de Espa√±a</label>
                                        <p class="text-gray-500 text-xs">Dividendos, intereses, venta de acciones, etc.</p>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors shadow-md">Calcular</button>
                            </form>
                            <div id="simulator-results" class="space-y-4"></div>
                        </div>
                        <div class="lg:col-span-3">
                            <div class="chart-container bg-gray-50 p-4 rounded-xl border border-gray-200">
                                <canvas id="taxChart"></canvas>
                            </div>
                             <div id="simulator-info" class="text-sm text-blue-800 bg-blue-100 p-4 rounded-lg mt-4 hidden"></div>
                        </div>
                    </div>
                </section>

                <section id="guia-section" class="content-section">
                     <div class="grid md:grid-cols-12 gap-8">
                        <aside class="md:col-span-3 lg:col-span-3">
                            <nav id="guide-menu" class="space-y-1 sticky top-8">
                                <!-- Menu items will be injected here by JS -->
                            </nav>
                        </aside>
                        <div id="guide-content" class="md:col-span-9 lg:col-span-9">
                            <!-- Content panels will be injected here by JS -->
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const data = {
                guide: [
                    {
                        title: 'Fundamentos del Visado y Residencia Fiscal',
                        icon: 'üõÇ',
                        content: `
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Fundamentos del Visado y Residencia Fiscal</h3>
                            <h4 class="text-xl font-semibold mb-3 text-gray-700">1. Introducci√≥n al Visado de N√≥mada Digital</h4>
                            <p class="mb-4 text-gray-600">El visado est√° concebido para nacionales de terceros estados que teletrabajan desde Espa√±a para empresas extranjeras.</p>
                            <strong class="block mb-2 font-medium">Perfiles del Solicitante:</strong>
                            <ul class="list-disc list-inside space-y-2 mb-4 text-gray-600">
                                <li><strong>Trabajador por cuenta ajena:</strong> Empleado de una o varias empresas cuya sede est√° fuera de Espa√±a.</li>
                                <li><strong>Trabajador por cuenta propia (aut√≥nomo):</strong> Profesional que presta servicios a clientes localizados fuera de Espa√±a.</li>
                            </ul>
                            <strong class="block mb-2 font-medium">Requisitos Clave con Repercusi√≥n Fiscal:</strong>
                            <ul class="list-disc list-inside space-y-2 mb-4 text-gray-600">
                                <li><strong>Medios Econ√≥micos:</strong> Demostrar ingresos m√≠nimos del 200% del Salario M√≠nimo Interprofesional (SMI) espa√±ol.</li>
                                <li><strong>Relaci√≥n Profesional Preexistente:</strong> Acreditar una relaci√≥n laboral o profesional de al menos 3 meses de antig√ºedad.</li>
                                <li><strong>L√≠mite de Ingresos Locales:</strong> Si es aut√≥nomo, los ingresos de empresas espa√±olas no pueden superar el 20% del total de su facturaci√≥n.</li>
                            </ul>
                            <h4 class="text-xl font-semibold mb-3 mt-8 text-gray-700">2. Residencia Fiscal en Espa√±a: ¬øCu√°ndo se convierte en contribuyente?</h4>
                            <p class="mb-4 text-gray-600">La adquisici√≥n de la residencia fiscal determina la obligaci√≥n de tributar en Espa√±a. No depende del visado, sino de criterios objetivos.</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-600">
                                <li><strong>Criterio Principal (Regla de los 183 D√≠as):</strong> Se adquiere la residencia fiscal al permanecer en Espa√±a m√°s de 183 d√≠as durante un a√±o natural. Las ausencias espor√°dicas cuentan como d√≠as de permanencia, salvo que se acredite residencia fiscal en otro pa√≠s.</li>
                                <li><strong>Criterios Subsidiarios:</strong> Tambi√©n puede adquirirse si el n√∫cleo principal de intereses econ√≥micos radica en Espa√±a, o si el c√≥nyuge e hijos menores residen aqu√≠.</li>
                                <li><strong>Efectos:</strong> La residencia fiscal se adquiere para la totalidad del a√±o natural. Si llega en febrero y cumple los 183 d√≠as en agosto, ser√° residente fiscal para todo el a√±o, desde el 1 de enero.</li>
                            </ul>
                        `
                    },
                    {
                        title: 'La Decisi√≥n Clave: Reg√≠menes Fiscales',
                        icon: '‚öñÔ∏è',
                        content: `
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">La Decisi√≥n Clave: R√©gimen General vs. Ley Beckham</h3>
                            <p class="mb-6 text-gray-600">Una vez residente fiscal, debe elegir entre dos sistemas. Esta elecci√≥n es fundamental y definir√° su carga tributaria.</p>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-gray-50 border border-gray-200 p-6 rounded-lg">
                                    <h4 class="text-lg font-semibold mb-2">Escenario A: R√©gimen General de IRPF (V√≠a por defecto)</h4>
                                    <p class="mb-3 text-sm text-gray-600">Si no solicita activamente otro r√©gimen, quedar√° sujeto a este.</p>
                                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
                                        <li><strong>Tributaci√≥n por Renta Mundial:</strong> Obligaci√≥n de declarar en Espa√±a la totalidad de sus ingresos mundiales.</li>
                                        <li><strong>Tipos Progresivos:</strong> La renta se grava por tramos, desde el 19% hasta el 47% o m√°s.</li>
                                        <li><strong>Otras Obligaciones:</strong> Incluye la declaraci√≥n anual (Modelo 100), declaraci√≥n de bienes en el extranjero (Modelo 720) e Impuesto sobre el Patrimonio (si aplica).</li>
                                        <li><strong>Aut√≥nomos:</strong> Requiere alta en Hacienda (Modelo 036/037), en Seguridad Social (RETA) y presentar declaraciones trimestrales de IVA (Modelo 303) y pagos a cuenta de IRPF (Modelo 130).</li>
                                    </ul>
                                </div>
                                <div class="bg-blue-50 border border-blue-200 p-6 rounded-lg">
                                    <h4 class="text-lg font-semibold mb-2 text-blue-800">Escenario B: Ley Beckham (V√≠a opcional)</h4>
                                    <p class="mb-3 text-sm text-gray-600">Permite tributar con reglas similares a las de un no residente, si se solicita a tiempo.</p>
                                    <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
                                        <li><strong>Tributaci√≥n Selectiva:</strong> Solo se tributa por rentas de fuente espa√±ola. ¬°OJO! Sus ingresos del trabajo siempre se consideran de fuente espa√±ola.</li>
                                        <li><strong>Tipo Fijo:</strong> Se aplica un tipo del <strong>24%</strong> hasta 600.000‚Ç¨ de ingresos.</li>
                                        <li><strong>Gran Ventaja:</strong> Las rentas de capital generadas fuera de Espa√±a (dividendos, intereses, plusval√≠as por venta de acciones, criptos, etc.) <strong>no tributan</strong>.</li>
                                        <li><strong>Simplificaci√≥n:</strong> No hay obligaci√≥n de presentar el Modelo 720 y el Impuesto sobre el Patrimonio solo afecta a bienes en Espa√±a.</li>
                                        <li><strong>Plazo Cr√≠tico:</strong> Debe solicitarse (Modelo 149) en los <strong>6 meses</strong> siguientes al alta en la Seguridad Social.</li>
                                    </ul>
                                </div>
                            </div>
                            <h4 class="text-xl font-semibold my-6 text-gray-700">Tabla Comparativa Detallada</h4>
                            <div class="overflow-x-auto rounded-lg border border-gray-200">
                                <table class="table-custom">
                                    <thead>
                                        <tr><th>Caracter√≠stica</th><th>R√©gimen General de IRPF</th><th>R√©gimen Especial (Ley Beckham)</th></tr>
                                    </thead>
                                    <tbody>
                                        <tr><td><strong>Base Imponible</strong></td><td>Renta Mundial.</td><td>Rentas de fuente espa√±ola (trabajo siempre incluido).</td></tr>
                                        <tr><td><strong>Tipo de Gravamen</strong></td><td>Progresivo (19% - 47%+).</td><td>Fijo (24% hasta 600.000 ‚Ç¨).</td></tr>
                                        <tr><td><strong>Dividendos/Intereses Extranjero</strong></td><td>Tributan (19% - 28%).</td><td><strong>No tributan</strong>.</td></tr>
                                        <tr><td><strong>Ganancias Patrimoniales Extranjero</strong></td><td>Tributan (19% - 28%).</td><td><strong>No tributan</strong>.</td></tr>
                                        <tr><td><strong>Deducci√≥n Cuotas S.S.</strong></td><td><strong>S√≠</strong>, es un gasto deducible.</td><td><strong>No</strong>, no se pueden deducir.</td></tr>
                                        <tr><td><strong>M√≠nimos Personales/Familiares</strong></td><td><strong>S√≠</strong>, reducen la base.</td><td><strong>No</strong>, no son aplicables.</td></tr>
                                        <tr><td><strong>Obligaci√≥n Modelo 720</strong></td><td><strong>S√≠</strong>.</td><td><strong>No</strong>.</td></tr>
                                        <tr><td><strong>Impuesto sobre el Patrimonio</strong></td><td>Grava el patrimonio <strong>mundial</strong>.</td><td>Grava el patrimonio en <strong>Espa√±a</strong>.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        `
                    },
                    {
                        title: 'Beneficios y Fiscalidad Internacional',
                        icon: 'üåç',
                        content: `
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Beneficios, Deducciones y Fiscalidad Internacional</h3>
                            <h4 class="text-xl font-semibold mb-3 text-gray-700">4. Beneficios Fiscales y Deducciones</h4>
                            <p class="mb-3 text-gray-600"><strong>Ley Beckham para Aut√≥nomos:</strong> El acceso no es universal. Se limita a perfiles que realicen una actividad calificada como <strong>emprendedora</strong> (con informe favorable de ENISA) o a <strong>profesionales altamente cualificados</strong> que presten servicios a startups o en I+D+i.</p>
                            <p class="mb-4 text-gray-600"><strong>Deducciones en R√©gimen General:</strong> Para quienes tributen en r√©gimen general, son clave:</p>
                            <ul class="list-disc list-inside space-y-2 mb-4 text-gray-600">
                                <li><strong>Cuota de Aut√≥nomos (RETA):</strong> Totalmente deducible.</li>
                                <li><strong>Suministros de la Vivienda:</strong> Un porcentaje de los gastos de luz, agua, internet, etc., si trabaja desde casa.</li>
                                <li><strong>Otros Gastos Profesionales:</strong> Compra de equipos, software, gestor√≠a, etc.</li>
                            </ul>
                            <h4 class="text-xl font-semibold mb-3 mt-8 text-gray-700">5. Aspectos Internacionales y Doble Imposici√≥n</h4>
                            <p class="mb-4 text-gray-600">Los Convenios de Doble Imposici√≥n (CDI) son vitales para evitar que una misma renta sea gravada dos veces. Establecen qu√© pa√≠s tiene la potestad de gravar cada renta.</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-600">
                                <li><strong>En R√©gimen General:</strong> Si una renta ya ha sido gravada en el pa√≠s de origen, Espa√±a aplica el <strong>m√©todo de imputaci√≥n (cr√©dito fiscal)</strong>: se permite deducir el impuesto pagado en el extranjero, con el l√≠mite del impuesto que corresponder√≠a pagar en Espa√±a.</li>
                                <li><strong>Convenios Relevantes (EE.UU., UK, etc.):</strong> Cada convenio tiene sus particularidades, pero la regla general es que la potestad tributaria principal sobre los rendimientos del trabajo del teletrabajador recae en Espa√±a como pa√≠s de residencia fiscal.</li>
                            </ul>
                        `
                    },
                    {
                        title: 'Errores Cr√≠ticos y FAQ',
                        icon: '‚ö†Ô∏è',
                        content: `
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Errores Cr√≠ticos y Preguntas Frecuentes</h3>
                            <h4 class="text-xl font-semibold mb-3 text-gray-700">Errores Comunes a Evitar</h4>
                            <ol class="list-decimal list-inside space-y-3 mb-8 text-gray-600">
                                <li><strong>Confundir Residencia Legal con Residencia Fiscal:</strong> El visado es el permiso para vivir; la estancia de m√°s de 183 d√≠as determina la obligaci√≥n de pagar impuestos.</li>
                                <li><strong>Perder el Plazo para Solicitar la Ley Beckham:</strong> No presentar el Modelo 149 en los 6 meses siguientes al alta en la Seguridad Social es un error irreversible.</li>
                                <li><strong>Omitir la Presentaci√≥n del Modelo 720:</strong> El desconocimiento no exime de su cumplimiento y las sanciones son muy severas.</li>
                                <li><strong>Asumir que la Renta Extranjera no Tributa:</strong> Un residente fiscal en Espa√±a tributa por su renta mundial (en r√©gimen general).</li>
                            </ol>
                            <h4 class="text-xl font-semibold mb-4 text-gray-700">Preguntas Frecuentes (FAQ)</h4>
                            <div class="space-y-4 text-gray-600">
                                <div>
                                    <strong class="font-semibold text-gray-800">¬øTengo que pagar impuestos en Espa√±a si mi empresa est√° fuera?</strong>
                                    <p>S√≠, si se convierte en residente fiscal. La cuesti√≥n no es *si* paga, sino *c√≥mo* paga (r√©gimen general o Ley Beckham).</p>
                                </div>
                                <div>
                                    <strong class="font-semibold text-gray-800">¬øA partir de qu√© ingresos interesa la Ley Beckham?</strong>
                                    <p>Suele ser ventajosa para rentas superiores a 60.000‚Ç¨ y/o si tiene importantes rentas de capital en el extranjero. Es imprescindible un c√°lculo personalizado.</p>
                                </div>
                                <div>
                                    <strong class="font-semibold text-gray-800">¬øPuedo solicitar el visado desde Espa√±a como turista?</strong>
                                    <p>S√≠, es una de sus grandes ventajas. La solicitud se tramita ante la Unidad de Grandes Empresas y Colectivos Estrat√©gicos (UGE).</p>
                                </div>
                                <div>
                                    <strong class="font-semibold text-gray-800">Soy aut√≥nomo y mis clientes est√°n en EE.UU., ¬øpago IVA?</strong>
                                    <p>No, la operaci√≥n est√° exenta de IVA. Sin embargo, debe darse de alta en Hacienda, emitir facturas sin IVA y presentar las declaraciones trimestrales (Modelo 303).</p>
                                </div>
                            </div>
                        `
                    },
                    {
                        title: 'Glosario de T√©rminos',
                        icon: 'üìñ',
                        content: `
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Glosario de T√©rminos Fiscales</h3>
                            <ul class="space-y-3 text-gray-600 columns-1 md:columns-2">
                                <li><strong>AEAT:</strong> Agencia Estatal de Administraci√≥n Tributaria.</li>
                                <li><strong>CDI:</strong> Convenio de Doble Imposici√≥n.</li>
                                <li><strong>IRPF:</strong> Impuesto sobre la Renta de las Personas F√≠sicas.</li>
                                <li><strong>IVA:</strong> Impuesto sobre el Valor A√±adido.</li>
                                <li><strong>Ley Beckham:</strong> R√©gimen fiscal especial para impatriados (art. 93 Ley IRPF).</li>
                                <li><strong>Modelo 100:</strong> Declaraci√≥n anual del IRPF (r√©gimen general).</li>
                                <li><strong>Modelo 149:</strong> Comunicaci√≥n de opci√≥n por la Ley Beckham.</li>
                                <li><strong>Modelo 151:</strong> Declaraci√≥n anual del IRPF para acogidos a la Ley Beckham.</li>
                                <li><strong>Modelo 720:</strong> Declaraci√≥n informativa sobre bienes y derechos en el extranjero.</li>
                                <li><strong>RETA:</strong> R√©gimen Especial de Trabajadores Aut√≥nomos.</li>
                                <li><strong>Residencia Fiscal:</strong> Condici√≥n que obliga a tributar en un pa√≠s por la renta mundial (principalmente por estancia > 183 d√≠as).</li>
                                <li><strong>SMI:</strong> Salario M√≠nimo Interprofesional.</li>
                                <li><strong>UGE:</strong> Unidad de Grandes Empresas y Colectivos Estrat√©gicos.</li>
                            </ul>
                        `
                    }
                ]
            };

            const tabSimulador = document.getElementById('tab-simulador');
            const tabGuia = document.getElementById('tab-guia');
            const simuladorSection = document.getElementById('simulador-section');
            const guiaSection = document.getElementById('guia-section');
            const form = document.getElementById('tax-simulator-form');
            const simulatorInfo = document.getElementById('simulator-info');
            const simulatorResults = document.getElementById('simulator-results');
            const guideMenu = document.getElementById('guide-menu');
            const guideContent = document.getElementById('guide-content');
            let taxChart;

            function init() {
                tabSimulador.addEventListener('click', () => showView('simulador'));
                tabGuia.addEventListener('click', () => showView('guia'));
                form.addEventListener('submit', handleFormSubmit);
                
                populateGuide();
                createChart();
            }

            function showView(view) {
                const tabs = [tabSimulador, tabGuia];
                const sections = [simuladorSection, guiaSection];
                
                tabs.forEach(t => t.classList.remove('active'));
                sections.forEach(s => s.classList.remove('active'));

                if (view === 'simulador') {
                    tabSimulador.classList.add('active');
                    simuladorSection.classList.add('active');
                } else if (view === 'guia') {
                    tabGuia.classList.add('active');
                    guiaSection.classList.add('active');
                }
            }
            
            function populateGuide() {
                guideMenu.innerHTML = data.guide.map((item, index) => `
                    <button class="guide-menu-item w-full text-left p-3 rounded-md flex items-center font-medium text-gray-600 hover:bg-gray-100" data-index="${index}">
                        <span class="text-xl mr-3">${item.icon}</span>
                        <span>${item.title}</span>
                    </button>
                `).join('');

                guideContent.innerHTML = data.guide.map((item, index) => `
                    <div class="guide-content-panel p-4" data-index="${index}">
                        ${item.content}
                    </div>
                `).join('');

                const menuItems = document.querySelectorAll('.guide-menu-item');
                menuItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const index = item.getAttribute('data-index');
                        showGuidePanel(index);
                    });
                });

                showGuidePanel(0); 
            }

            function showGuidePanel(index) {
                document.querySelectorAll('.guide-menu-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`.guide-menu-item[data-index='${index}']`).classList.add('active');

                document.querySelectorAll('.guide-content-panel').forEach(panel => panel.classList.remove('active'));
                document.querySelector(`.guide-content-panel[data-index='${index}']`).classList.add('active');
            }
            
            function handleFormSubmit(e) {
                e.preventDefault();
                const income = parseFloat(document.getElementById('annual-income').value);
                const hasCapitalGains = document.getElementById('capital-gains').checked;

                if (isNaN(income) || income <= 0) {
                    alert('Por favor, introduzca un valor de ingresos v√°lido.');
                    return;
                }

                const taxGeneral = calculateGeneralTax(income);
                const taxBeckham = calculateBeckhamTax(income);
                const savings = taxGeneral - taxBeckham;

                updateChart(taxGeneral, taxBeckham);
                updateSimulatorInfo(income, hasCapitalGains, savings);
                updateResults(taxGeneral, taxBeckham, savings);
            }

            function updateResults(general, beckham, savings) {
                simulatorResults.innerHTML = `
                    <div class="bg-gray-100 p-4 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600">Impuesto R√©gimen General</p>
                        <p class="text-2xl font-bold text-gray-800">${formatCurrency(general)}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <p class="text-sm text-blue-700">Impuesto Ley Beckham</p>
                        <p class="text-2xl font-bold text-blue-800">${formatCurrency(beckham)}</p>
                    </div>
                     <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                        <p class="text-sm text-green-700">Ahorro Anual Estimado con Ley Beckham</p>
                        <p class="text-2xl font-bold text-green-800">${formatCurrency(savings)}</p>
                    </div>
                `;
            }

            function updateSimulatorInfo(income, hasCapitalGains, savings) {
                let infoText = '';
                if (savings > 0) {
                    infoText = `Con sus ingresos, la <strong>Ley Beckham parece ser la opci√≥n m√°s ventajosa</strong>, con un ahorro estimado de ${formatCurrency(savings)}.`;
                } else {
                    infoText = `Con sus ingresos, el <strong>R√©gimen General podr√≠a ser m√°s conveniente</strong>, especialmente si tiene derecho a deducciones (cuota de aut√≥nomo, etc.) que no se aplican en la Ley Beckham.`;
                }
                
                if (hasCapitalGains) {
                    infoText += ' Adem√°s, al tener rentas de capital fuera de Espa√±a, el beneficio de la Ley Beckham es a√∫n mayor, ya que esas rentas <strong>no tributar√≠an</strong>.';
                }
                simulatorInfo.innerHTML = infoText;
                simulatorInfo.classList.remove('hidden');
            }

            function calculateGeneralTax(income) {
                let tax = 0;
                const effectiveIncome = income * 0.93; 
                
                if (effectiveIncome <= 12450) tax = effectiveIncome * 0.19;
                else if (effectiveIncome <= 20200) tax = (12450 * 0.19) + ((effectiveIncome - 12450) * 0.24);
                else if (effectiveIncome <= 35200) tax = (12450 * 0.19) + (7750 * 0.24) + ((effectiveIncome - 20200) * 0.30);
                else if (effectiveIncome <= 60000) tax = (12450 * 0.19) + (7750 * 0.24) + (15000 * 0.30) + ((effectiveIncome - 35200) * 0.37);
                else if (effectiveIncome <= 300000) tax = (12450 * 0.19) + (7750 * 0.24) + (15000 * 0.30) + (24800 * 0.37) + ((effectiveIncome - 60000) * 0.45);
                else tax = (12450 * 0.19) + (7750 * 0.24) + (15000 * 0.30) + (24800 * 0.37) + (240000 * 0.45) + ((effectiveIncome - 300000) * 0.47);
                
                return Math.round(tax);
            }

            function calculateBeckhamTax(income) {
                if (income <= 600000) {
                    return Math.round(income * 0.24);
                } else {
                    return Math.round((600000 * 0.24) + ((income - 600000) * 0.47));
                }
            }
            
            function formatCurrency(value) {
                return '‚Ç¨' + value.toLocaleString('es-ES', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            }

            function createChart() {
                const ctx = document.getElementById('taxChart').getContext('2d');
                taxChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['R√©gimen General', 'Ley Beckham'],
                        datasets: [{
                            label: 'Impuesto Anual Estimado (‚Ç¨)',
                            data: [0, 0],
                            backgroundColor: ['rgba(107, 114, 128, 0.7)', 'rgba(59, 130, 246, 0.7)'],
                            borderColor: ['rgba(75, 85, 99, 1)', 'rgba(59, 130, 246, 1)'],
                            borderWidth: 1,
                            borderRadius: 5,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: { callback: value => formatCurrency(value) }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: 'Comparativa de Impuestos Anuales', font: { size: 16 } },
                            tooltip: { callbacks: { label: context => formatCurrency(context.parsed.x) } }
                        }
                    }
                });
            }

            function updateChart(general, beckham) {
                taxChart.data.datasets[0].data = [general, beckham];
                taxChart.update();
            }

            init();
        });
    </script>
</body>
</html>
